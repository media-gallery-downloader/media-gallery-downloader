{
	frankenphp

	order php_server before file_server

	log {
		level ERROR
		output file /app/storage/logs/caddy.log
	}

	storage file_system {
		root /app/storage/caddy
	}

	servers {
		protocols h1 h2 h3
	}
}

mgd.localhost {
	root * /app/public

	@static {
		file
		path *.css *.js *.png *.jpg *.jpeg *.gif *.webp *.svg *.ico *.woff *.woff2 *.ttf *.eot
	}
	header @static Cache-Control "public, max-age=31536000, immutable"

	encode zstd br gzip

	header {
		X-Content-Type-Options nosniff
		X-Frame-Options DENY
		X-XSS-Protection "1; mode=block"
		Referrer-Policy strict-origin-when-cross-origin
	}

	try_files {path} {path}/ /index.php?{query}
	php_server

	file_server
}
