{
	frankenphp

	order php_server before file_server

	log {
		level ERROR
		output file /app/storage/logs/caddy.log
	}

	storage file_system {
		root /app/storage/caddy
	}

    http_port 8080
    https_port 8443

	servers {
		protocols h1 h2 h3
	}
}

mgd.localhost {
	root * /app/public

	# Allow large file uploads (50GB)
	request_body {
		max_size 50GB
	}

	@static {
		file
		path *.css *.js *.png *.jpg *.jpeg *.gif *.webp *.svg *.ico *.woff *.woff2 *.ttf *.eot
	}
	header @static Cache-Control "public, max-age=31536000, immutable"

	encode zstd br gzip

	header {
		# HSTS - enforce HTTPS for 1 year, include subdomains
		Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
		# Prevent MIME type sniffing
		X-Content-Type-Options nosniff
		# Prevent clickjacking
		X-Frame-Options DENY
		# XSS protection (legacy browsers)
		X-XSS-Protection "1; mode=block"
		# Control referrer information
		Referrer-Policy strict-origin-when-cross-origin
		# Permissions policy (disable unnecessary features)
		Permissions-Policy "accelerometer=(), camera=(), geolocation=(), gyroscope=(), magnetometer=(), microphone=(), payment=(), usb=()"
		# Remove server identification
		-Server
	}

	try_files {path} {path}/ /index.php?{query}
	php_server

	file_server
}
