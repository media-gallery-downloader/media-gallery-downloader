{
	frankenphp

	order php_server before file_server

	# Disable automatic HTTPS - container serves HTTP only behind reverse proxy
	auto_https off

	log {
		level ERROR
		output file /app/storage/logs/caddy.log
	}

	http_port 8080

	servers {
		protocols h1 h2
	}
}

:8080 {
	root * /app/public

	# Allow large file uploads (50GB)
	request_body {
		max_size 50GB
	}

	@static {
		file
		path *.css *.js *.png *.jpg *.jpeg *.gif *.webp *.svg *.ico *.woff *.woff2 *.ttf *.eot
	}
	header @static Cache-Control "public, max-age=31536000, immutable"

	encode zstd br gzip

	header {
		# Prevent MIME type sniffing
		X-Content-Type-Options nosniff
		# Prevent clickjacking
		X-Frame-Options DENY
		# XSS protection (legacy browsers)
		X-XSS-Protection "1; mode=block"
		# Control referrer information
		Referrer-Policy strict-origin-when-cross-origin
		# Permissions policy (disable unnecessary features)
		Permissions-Policy "accelerometer=(), camera=(), geolocation=(), gyroscope=(), magnetometer=(), microphone=(), payment=(), usb=()"
		# Remove server identification
		-Server
	}

	try_files {path} {path}/ /index.php?{query}
	php_server

	file_server
}
